(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[190],{4476:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/cart",function(){return r(722)}])},722:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return A}});var i=r(5893),a=r(9008),l=r.n(a),s=r(7294),c=r(4184),n=r.n(c),o=r(6792);let d=s.forwardRef(({bsPrefix:e,className:t,striped:r,bordered:a,borderless:l,hover:s,size:c,variant:d,responsive:u,...h},m)=>{let g=(0,o.vE)(e,"table"),p=n()(t,g,d&&`${g}-${d}`,c&&`${g}-${c}`,r&&`${g}-${"string"==typeof r?`striped-${r}`:"striped"}`,a&&`${g}-bordered`,l&&`${g}-borderless`,s&&`${g}-hover`),f=(0,i.jsx)("table",{...h,className:p,ref:m});if(u){let x=`${g}-responsive`;return"string"==typeof u&&(x=`${x}-${u}`),(0,i.jsx)("div",{className:x,children:f})}return f});var u=r(4102),h=r(5168),m=r(2310),g=r(2489),p=r(2411),f=r(129),x=r.n(f),j=r(9827);let v=e=>{if("number"==typeof e)return[e];let t=[];return Object.values(e).forEach(e=>{t.push(...v(e))}),t};var _=r(8945),b=new class{async loadPrices(e){let t={},r=[];if(e.forEach(e=>{if(void 0!==this.cached[e])return t[e]=this.cached[e];r.push(e)}),r.length)try{let i=await _.Z.post("".concat("https://firma-crm.by","/price/get-by-product-ids"),{ids:r});201===i.status&&i.data.forEach(e=>{let r=e.price_rb;t[e.product_id]=r,this.cached[e.product_id]=r})}catch(a){return null}return t}constructor(){this.cached={}}};let y={populate:{preview:{fields:["url","width","height"]},images:{fields:["url","width","height"]},subcategories:{fields:["name"],populate:{category:{fields:["name"]}}}}};var w=new class{async getAll(e,t){let r=e?"?".concat(x().stringify(e,{encodeValuesOnly:!0})):"",{items:i,pagination:a}=await (0,j.qm)("products"+r),l=[];i.forEach(e=>{let t=e.calculator?v(e.calculator):[e.price_id];l.push(...t)});let s=await b.loadPrices(l);if(!s)return t?{pagination:a,products:[]}:[];let c=i.map(e=>{let t=s[e.price_id];if(e.calculator){let r=v(e.calculator);r.forEach((r,i)=>{0===i&&(t=s[r]);let a=function e(t,r){if("object"!=typeof t)return null;let i=null;for(let a of Object.keys(t)){let l=t[a];if("object"==typeof l&&null!==(i=e(l,r)))break;if(r===l){i=[t,a];break}}return i}(e.calculator,r);if(a){let[l,c]=a;l[c]=s[r]}})}return t?{...e,price:t}:e});return t?{pagination:a,products:c}:c}async getByCategoryName(e,t){let r="?".concat(x().stringify({...y,filters:{subcategories:{category:{name:{$eqi:e}},...(null==t?void 0:t.subcategoryFilters)||{}},...(null==t?void 0:t.productFilters)||{}},...(null==t?void 0:t.page)!==void 0?{pagination:{page:t.page,pageSize:20}}:{}},{encodeValuesOnly:!0})),i=await (0,j.qm)("products"+r),a=await b.loadPrices(i.items.map(e=>e.price_id));return{products:a?i.items.map(e=>{let t=a[e.price_id];return t?{...e,price:t}:e}):[],pagination:i.pagination}}async getByFlag(e,t,r){return this.getAll({...y,filters:{[e]:{$eq:!0},...r?{name:{$ne:r}}:{},...t?{subcategories:{category:{name:{$eqi:t}}}}:{}},pagination:{limit:10}})}async getByName(e,t){let r=await this.getAll({...y,filters:{name:{$eqi:e},subcategories:{category:{name:{$eqi:t}}}}});return r.length?r[0]:null}},N=r(2836),$=r.n(N),k=r(458),E=r(48),C=r(3756),P=r(2452),q=r.n(P),M=r(5675),R=r.n(M),L=r(1664),O=r.n(L),z=r(5131);let S=e=>{let{product:t,handleChangeCount:r}=e,a=(0,s.useMemo)(()=>{let e=t.preview;if(!e&&t.images){let r=t.images[0];r&&(e=r)}return e?{imageURL:e.url,imageWidth:e.width,imageHeight:e.height}:null},[t]),l=(0,s.useMemo)(()=>{var e;let r="/";if((null===(e=t.subcategories)||void 0===e?void 0:e.length)&&t.subcategories[0].category){let i=t.href,a=t.subcategories[0].category.href;r="/catalog/".concat(a,"/").concat(i)}return r},[t]),c=()=>{k.Z.remove(t.id)};return(0,i.jsx)("article",{className:q().mobile,children:(0,i.jsxs)("div",{className:"row",children:[(0,i.jsx)("div",{className:"col-4",children:(0,i.jsx)("div",{className:q().mobile_image,children:a&&(0,i.jsx)(R(),{src:a.imageURL,width:a.imageWidth,height:a.imageHeight,alt:t.name})})}),(0,i.jsxs)("div",{className:"col-8",children:[(0,i.jsx)(O(),{href:l,children:t.name}),(0,i.jsxs)("div",{className:q().mobile_price,children:[(0,i.jsxs)("p",{children:["Цена: ",t.price," руб."]}),(0,i.jsxs)("p",{children:["Сумма: ",t.price*t.count," руб."]})]}),(0,i.jsxs)("div",{className:"d-flex align-items-center justify-content-between",children:[(0,i.jsx)(z.P,{value:t.count,setValue:r}),(0,i.jsx)(h.z,{sizeMode:"sm",variant:"red",onClick:c,children:"Удалить"})]})]})]})})};var W=r(8564),F=r.n(W);let U=e=>{let{product:t,idx:r,handleChangeCount:a}=e,l=(0,s.useMemo)(()=>{let e=t.preview;if(!e&&t.images){let r=t.images[0];r&&(e=r)}return e?{imageURL:e.url,imageWidth:e.width,imageHeight:e.height}:null},[t]),c=(0,s.useMemo)(()=>{var e;let r="/";if((null===(e=t.subcategories)||void 0===e?void 0:e.length)&&t.subcategories[0].category){let i=t.href,a=t.subcategories[0].category.href;r="/catalog/".concat(a,"/").concat(i)}return r},[t]),n=()=>{k.Z.remove(t.id)};return(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:r+1}),(0,i.jsx)("td",{children:(0,i.jsxs)(O(),{href:c,className:F().title,children:[l&&(0,i.jsx)(R(),{src:l.imageURL,width:l.imageWidth,height:l.imageHeight,alt:t.name}),(0,i.jsx)("span",{children:t.name})]})}),(0,i.jsxs)("td",{className:F().price,children:[t.price," руб."]}),(0,i.jsx)("td",{children:(0,i.jsx)("div",{className:F().count,children:(0,i.jsx)(z.P,{value:t.count,setValue:a})})}),(0,i.jsxs)("td",{className:F().price,children:[t.price*t.count," руб."]}),(0,i.jsx)("td",{className:F().delete,children:(0,i.jsx)("i",{onClick:n,className:"fa fa-times"})})]})},Z=()=>{let e=(0,p._)("cart"),[t,r]=(0,s.useState)(!1),[a,c]=(0,s.useState)(null),n=(0,C.Z)("(max-width: 575px)"),o=e&&a&&!!a.length,f=function(e){let t=(0,s.useRef)(e);return(0,s.useLayoutEffect)(()=>{t.current=e},[e]),t}((null==a?void 0:a.length)||0),x=(0,s.useMemo)(()=>a?a.reduce((e,t)=>e+=t.price*t.count,0):0,[a]),j=(0,s.useCallback)(async()=>{if(!e||Object.keys(e).length===f.current)return;let t=Object.keys(e).map(e=>Number(e));r(!0);try{let i=await w.getAll({...y,filters:{id:{$in:t.length?t:[-1]}}});c(i.map(t=>{let r=e[t.id].price,i=e[t.id].count;return{...t,price:r,count:i}}))}catch(a){console.error(a)}r(!1)},[e,f]);(0,s.useEffect)(()=>{j()},[j]);let v=e=>t=>{a&&c(a.map(r=>{if(r.id===e){let i=t;return"function"==typeof t&&(i=t(r.count)),k.Z.add(r.id,{price:r.price,count:i}),{...r,count:i}}return r}))};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(l(),{children:(0,i.jsx)("title",{children:"Корзина"})}),(0,i.jsx)(u.O,{}),(0,i.jsx)("section",{className:$().section,children:(0,i.jsx)(m.W,{children:t?(0,i.jsx)(g.a,{withoutOverlay:!0}):(0,i.jsx)(i.Fragment,{children:o?(0,i.jsxs)("div",{className:"row",children:[(0,i.jsx)("div",{className:"col-lg-8 col-12",children:n?a.map(e=>(0,i.jsx)(S,{handleChangeCount:v(e.id),product:e},e.id)):(0,i.jsxs)(d,{className:$().table,children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"#"}),(0,i.jsx)("th",{children:"Товары"}),(0,i.jsx)("th",{children:"Цена"}),(0,i.jsx)("th",{children:"Кол-во"}),(0,i.jsx)("th",{children:"Сумма"}),(0,i.jsx)("th",{})]})}),(0,i.jsx)("tbody",{children:a.map((e,t)=>(0,i.jsx)(U,{handleChangeCount:v(e.id),product:e,idx:t},e.id))})]})}),(0,i.jsxs)("div",{className:"col-lg-4 col-md-6 col-sm-8 col-12",children:[(0,i.jsxs)("h4",{children:["Итого: ",(0,i.jsx)("b",{children:x})," руб."]}),(0,i.jsxs)("form",{children:[(0,i.jsx)(E.I,{name:"name",placeholder:"Ваше Имя"}),(0,i.jsx)(E.I,{name:"phone",placeholder:"Ваш Номер",required:!0}),(0,i.jsx)(h.z,{type:"submit",variant:"primary",children:"Оформить заказ"})]})]})]}):(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)("h4",{children:"Ваша корзина пуста"}),(0,i.jsx)(h.z,{className:"mt-4",variant:"primary",isLink:{href:"/catalog"},children:"Перейти к покупкам"})]})})})})]})};var A=Z},4102:function(e,t,r){"use strict";r.d(t,{O:function(){return d}});var i=r(5893),a=r(1664),l=r.n(a),s=r(7294);let c=e=>decodeURI(e).replaceAll("_"," ");var n=r(2310);let o={catalog:"Каталог",search:"Поиск",cart:"Корзина",delivery:"Доставка",payment:"Оплата",about:"О нас",stock:"Акции",blog:"Блог",faq:"Задать вопрос",galery:"Галерея",garanty:"Гарантия",viewed:"Раннее вы смотрели"},d=e=>{let{replace:t}=e,[r,a]=(0,s.useState)([[],void 0]),[d,u]=r;return(0,s.useEffect)(()=>{let e="/",r=decodeURI(window.location.pathname).split("/").slice(1).map(r=>{let i=e+r+"/";e=i;let a=!!(t&&void 0!==t[r]),l=void 0!==o[r],s=a?t[r]:l?o[r]:c(r);return{href:i,name:s}}),i=r.pop();a([r,i])},[t]),(0,i.jsx)(n.W,{children:(0,i.jsx)("nav",{"aria-label":"breadcrumb",children:(0,i.jsxs)("ol",{className:"breadcrumb",children:[(0,i.jsx)("li",{className:"breadcrumb-item",children:(0,i.jsx)(l(),{href:"/",children:"Главная"})}),d.map(e=>(0,i.jsx)("li",{className:"breadcrumb-item",children:(0,i.jsx)(l(),{href:e.href,children:e.name})},e.href)),u&&(0,i.jsx)("li",{className:"breadcrumb-item active","aria-current":"page",children:u.name})]})})})}},5131:function(e,t,r){"use strict";r.d(t,{P:function(){return o}});var i=r(5893),a=r(7294),l=r(5168),s=r(48),c=r(6),n=r.n(c);let o=e=>{let{value:t,setValue:r}=e,[c,o]=(0,a.useState)(t.toString()),d=e=>{let i=e.target.value,a=Number(i);return Number.isNaN(a)?o(t.toString()):a<1?(o("1"),r(1)):a>20?(o("20"),r(20)):void r(a)},u=e=>{o(e.target.value)},h=()=>{t<20&&r(e=>e+1)},m=()=>{t>1&&r(e=>e-1)};return(0,a.useEffect)(()=>{o(t.toString())},[t]),(0,i.jsxs)("div",{className:n().wrapper,children:[(0,i.jsx)(l.z,{sizeMode:"sm",variant:"orange",onClick:m,children:(0,i.jsx)("i",{className:"fa fa-minus","aria-hidden":"true"})}),(0,i.jsx)(s.I,{onBlur:d,value:c,onChange:u,type:"text"}),(0,i.jsx)(l.z,{sizeMode:"sm",variant:"orange",onClick:h,children:(0,i.jsx)("i",{className:"fa fa-plus","aria-hidden":"true"})})]})}},2489:function(e,t,r){"use strict";r.d(t,{a:function(){return c}});var i=r(5893);r(7294);var a=r(9794),l=r(4898),s=r.n(l);let c=e=>{let{withoutOverlay:t}=e;return(0,i.jsx)("div",{className:(0,a.o)([s().loading,t?void 0:s().overlay]),children:(0,i.jsx)("i",{className:"fa fa-repeat","aria-hidden":"true"})})}},458:function(e,t,r){"use strict";var i=r(5838);let a="cart";t.Z=new class{add(e,t){let r=i.Y.get(a);i.Y.set(a,{...r||{},[e]:t})}remove(e){let t=i.Y.get(a);t&&(delete t[e],i.Y.set(a,t))}}},2836:function(e){e.exports={section:"CartPage_section__k1QGG",table:"CartPage_table__8qSiW"}},2452:function(e){e.exports={mobile:"MobileView_mobile__XPLwD",mobile_image:"MobileView_mobile_image__MWt9F",mobile_price:"MobileView_mobile_price__vqZ_U"}},6:function(e){e.exports={wrapper:"CountInput_wrapper__AZKJT"}},4898:function(e){e.exports={loading:"Loader_loading___H9TE",show:"Loader_show__YFqMF",rotate:"Loader_rotate__x_v_I",overlay:"Loader_overlay__lKXgr"}},8564:function(e){e.exports={title:"ProductRow_title__vgAqP",count:"ProductRow_count__WHBo8",price:"ProductRow_price__wfsEt",delete:"ProductRow_delete__T82HU"}}},function(e){e.O(0,[774,888,179],function(){return e(e.s=4476)}),_N_E=e.O()}]);