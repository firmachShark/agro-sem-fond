(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[190],{4476:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/cart",function(){return i(8045)}])},8045:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return D}});var r=i(5893),a=i(9008),l=i.n(a),s=i(7294),c=i(5147),n=i(4102),o=i(5168),d=i(2310),u=i(2489),h=i(2411),m=i(129),p=i.n(m),g=i(9827);let f=e=>{if("number"==typeof e)return[e];let t=[];return Object.values(e).forEach(e=>{t.push(...f(e))}),t};var x=i(8945),j=new class{async loadPrices(e){let t={},i=e.map(e=>e.id);if(i.length)try{let r=await x.Z.post("".concat("https://firma-crm.by","/price/get-by-product-ids"),{ids:i});201===r.status&&r.data.forEach(i=>{let r=e.find(e=>e.id===i.product_id),a="price_rb";(null==r?void 0:r.priceWithDelivery)&&(a="price_delivery_br");let l=i[a];t[i.product_id]=l})}catch(a){return null}return t}},_=i(5423),v=i(6972);let b=async e=>{let t=await (0,_.j)().use(v.Z).process(e);return t.toString()},y={populate:{preview:{fields:["url","width","height"]},images:{fields:["url","width","height"]},subcategories:{fields:["name"],populate:{category:{fields:["name"]}}}}};var w=new class{async getAll(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{_query:t,withDescription:i,withPagination:r}=e,a=t?"?".concat(p().stringify(t,{encodeValuesOnly:!0})):"",{items:l,pagination:s}=await (0,g.qm)("products"+a),c=[];l.forEach(e=>{let t=e.calculator?f(e.calculator):[e.price_id];t.forEach(t=>c.push({id:t,priceWithDelivery:e.priceWithDelivery}))});let n=await j.loadPrices(c);if(!n)return r?{pagination:s,products:[]}:[];let o=[];for(let d of l){let u=n[d.price_id];if(d.calculator){let h=f(d.calculator);h.forEach((e,t)=>{0===t&&(u=n[e]);let i=function e(t,i){if("object"!=typeof t)return null;let r=null;for(let a of Object.keys(t)){let l=t[a];if("object"==typeof l&&null!==(r=e(l,i)))break;if(i===l){r=[t,a];break}}return r}(d.calculator,e);if(i){let[r,a]=i;r[a]=n[e]}})}let m={...d};u&&(m.price=u),i&&(m.description=await b(d.description)),o.push(m)}return r?{pagination:s,products:o}:o}async getByCategoryName(e,t){let i="?".concat(p().stringify({...y,filters:{subcategories:{category:{name:{$eqi:e}},...(null==t?void 0:t.subcategoryFilters)||{}},...(null==t?void 0:t.productFilters)||{}},...(null==t?void 0:t.page)!==void 0?{pagination:{page:t.page,pageSize:20}}:{}},{encodeValuesOnly:!0})),r=await (0,g.qm)("products"+i),a=await j.loadPrices(r.items.map(e=>({id:e.price_id,priceWithDelivery:e.priceWithDelivery})));return{products:a?r.items.map(e=>{let t=a[e.price_id];return t?{...e,price:t}:e}):[],pagination:r.pagination}}async getByFlag(e,t,i){return this.getAll({_query:{...y,filters:{[e]:{$eq:!0},...i?{name:{$ne:i}}:{},...t?{subcategories:{category:{name:{$eqi:t}}}}:{}},pagination:{limit:10}}})}async getByName(e,t){let i=await this.getAll({_query:{...y,filters:{name:{$eqi:e},subcategories:{category:{name:{$eqi:t}}}}},withDescription:!0});return i.length?i[0]:null}},N=i(2836),k=i.n(N),q=i(458),C=i(48),E=i(3756),P=i(2452),W=i.n(P),M=i(5675),L=i.n(M),O=i(1664),R=i.n(O),S=i(5131);let Z=e=>{let{product:t,handleChangeCount:i}=e,a=(0,s.useMemo)(()=>{let e=t.preview;if(!e&&t.images){let i=t.images[0];i&&(e=i)}return e?{imageURL:e.url,imageWidth:e.width,imageHeight:e.height}:null},[t]),l=(0,s.useMemo)(()=>{var e;let i="/";if((null===(e=t.subcategories)||void 0===e?void 0:e.length)&&t.subcategories[0].category){let r=t.href,a=t.subcategories[0].category.href;i="/catalog/".concat(a,"/").concat(r)}return i},[t]),c=()=>{q.Z.remove(t.id)};return(0,r.jsx)("article",{className:W().mobile,children:(0,r.jsxs)("div",{className:"row",children:[(0,r.jsx)("div",{className:"col-4",children:(0,r.jsx)("div",{className:W().mobile_image,children:a&&(0,r.jsx)(L(),{src:a.imageURL,width:a.imageWidth,height:a.imageHeight,alt:t.name})})}),(0,r.jsxs)("div",{className:"col-8",children:[(0,r.jsx)(R(),{href:l,children:t.name}),(0,r.jsxs)("div",{className:W().mobile_price,children:[(0,r.jsxs)("p",{children:["Цена: ",t.price," руб."]}),(0,r.jsxs)("p",{children:["Сумма: ",t.price*t.count," руб."]})]}),(0,r.jsxs)("div",{className:"d-flex align-items-center justify-content-between",children:[(0,r.jsx)(S.P,{value:t.count,setValue:i}),(0,r.jsx)(o.z,{sizeMode:"sm",variant:"red",onClick:c,children:"Удалить"})]})]})]})})};var z=i(8564),F=i.n(z);let U=e=>{let{product:t,idx:i,handleChangeCount:a}=e,l=(0,s.useMemo)(()=>{let e=t.preview;if(!e&&t.images){let i=t.images[0];i&&(e=i)}return e?{imageURL:e.url,imageWidth:e.width,imageHeight:e.height}:null},[t]),c=(0,s.useMemo)(()=>{var e;let i="/";if((null===(e=t.subcategories)||void 0===e?void 0:e.length)&&t.subcategories[0].category){let r=t.href,a=t.subcategories[0].category.href;i="/catalog/".concat(a,"/").concat(r)}return i},[t]),n=()=>{q.Z.remove(t.id)};return(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:i+1}),(0,r.jsx)("td",{children:(0,r.jsxs)(R(),{href:c,className:F().title,children:[l&&(0,r.jsx)(L(),{src:l.imageURL,width:l.imageWidth,height:l.imageHeight,alt:t.name}),(0,r.jsx)("span",{children:t.name})]})}),(0,r.jsxs)("td",{className:F().price,children:[t.price," руб."]}),(0,r.jsx)("td",{children:(0,r.jsx)("div",{className:F().count,children:(0,r.jsx)(S.P,{value:t.count,setValue:a})})}),(0,r.jsxs)("td",{className:F().price,children:[t.price*t.count," руб."]}),(0,r.jsx)("td",{className:F().delete,children:(0,r.jsx)("i",{onClick:n,className:"fa fa-times"})})]})},A=()=>{let e=(0,h._)("cart"),[t,i]=(0,s.useState)(!1),[a,m]=(0,s.useState)(null),p=(0,E.Z)("(max-width: 575px)"),g=e&&a&&!!a.length,f=function(e){let t=(0,s.useRef)(e);return(0,s.useLayoutEffect)(()=>{t.current=e},[e]),t}((null==a?void 0:a.length)||0),x=(0,s.useMemo)(()=>a?a.reduce((e,t)=>e+=t.price*t.count,0):0,[a]),j=(0,s.useCallback)(async()=>{if(!e||Object.keys(e).length===f.current)return;let t=Object.keys(e).map(e=>Number(e));i(!0);try{let r=await w.getAll({_query:{...y,filters:{id:{$in:t.length?t:[-1]}}}});m(r.map(t=>{let i=e[t.id].price,r=e[t.id].count;return{...t,price:i,count:r}}))}catch(a){console.error(a)}i(!1)},[e,f]);(0,s.useEffect)(()=>{j()},[j]);let _=e=>t=>{a&&m(a.map(i=>{if(i.id===e){let r=t;return"function"==typeof t&&(r=t(i.count)),q.Z.add(i.id,{price:i.price,count:r}),{...i,count:r}}return i}))};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l(),{children:(0,r.jsx)("title",{children:"Корзина"})}),(0,r.jsx)(n.O,{}),(0,r.jsx)("section",{className:k().section,children:(0,r.jsx)(d.W,{children:t?(0,r.jsx)(u.a,{withoutOverlay:!0}):(0,r.jsx)(r.Fragment,{children:g?(0,r.jsxs)("div",{className:"row",children:[(0,r.jsx)("div",{className:"col-lg-8 col-12",children:p?a.map(e=>(0,r.jsx)(Z,{handleChangeCount:_(e.id),product:e},e.id)):(0,r.jsxs)(c.Z,{className:k().table,children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:"#"}),(0,r.jsx)("th",{children:"Товары"}),(0,r.jsx)("th",{children:"Цена"}),(0,r.jsx)("th",{children:"Кол-во"}),(0,r.jsx)("th",{children:"Сумма"}),(0,r.jsx)("th",{})]})}),(0,r.jsx)("tbody",{children:a.map((e,t)=>(0,r.jsx)(U,{handleChangeCount:_(e.id),product:e,idx:t},e.id))})]})}),(0,r.jsxs)("div",{className:"col-lg-4 col-md-6 col-sm-8 col-12",children:[(0,r.jsxs)("h4",{children:["Итого: ",(0,r.jsx)("b",{children:x})," руб."]}),(0,r.jsxs)("form",{children:[(0,r.jsx)(C.I,{name:"name",placeholder:"Ваше Имя"}),(0,r.jsx)(C.I,{name:"phone",placeholder:"Ваш Номер",required:!0}),(0,r.jsx)(o.z,{type:"submit",variant:"primary",children:"Оформить заказ"})]})]})]}):(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h4",{children:"Ваша корзина пуста"}),(0,r.jsx)(o.z,{className:"mt-4",variant:"primary",isLink:{href:"/catalog"},children:"Перейти к покупкам"})]})})})})]})};var D=A},4102:function(e,t,i){"use strict";i.d(t,{O:function(){return d}});var r=i(5893),a=i(1664),l=i.n(a),s=i(7294);let c=e=>decodeURI(e).replaceAll("_"," ");var n=i(2310);let o={catalog:"Каталог",search:"Поиск",cart:"Корзина",delivery:"Доставка",payment:"Оплата",about:"О нас",stock:"Акции",blog:"Блог",faq:"Задать вопрос",galery:"Галерея",garanty:"Гарантия",viewed:"Раннее вы смотрели"},d=e=>{let{replace:t}=e,[i,a]=(0,s.useState)([[],void 0]),[d,u]=i;return(0,s.useEffect)(()=>{let e="/",i=decodeURI(window.location.pathname).split("/").slice(1).map(i=>{let r=e+i+"/";e=r;let a=!!(t&&void 0!==t[i]),l=void 0!==o[i],s=a?t[i]:l?o[i]:c(i);return{href:r,name:s}}),r=i.pop();a([i,r])},[t]),(0,r.jsx)(n.W,{children:(0,r.jsx)("nav",{"aria-label":"breadcrumb",children:(0,r.jsxs)("ol",{className:"breadcrumb",children:[(0,r.jsx)("li",{className:"breadcrumb-item",children:(0,r.jsx)(l(),{href:"/",children:"Главная"})}),d.map(e=>(0,r.jsx)("li",{className:"breadcrumb-item",children:(0,r.jsx)(l(),{href:e.href,children:e.name})},e.href)),u&&(0,r.jsx)("li",{className:"breadcrumb-item active","aria-current":"page",children:u.name})]})})})}},5131:function(e,t,i){"use strict";i.d(t,{P:function(){return o}});var r=i(5893),a=i(7294),l=i(5168),s=i(48),c=i(6),n=i.n(c);let o=e=>{let{value:t,setValue:i}=e,[c,o]=(0,a.useState)(t.toString()),d=e=>{let r=e.target.value,a=Number(r);return Number.isNaN(a)?o(t.toString()):a<1?(o("1"),i(1)):a>20?(o("20"),i(20)):void i(a)},u=e=>{o(e.target.value)},h=()=>{t<20&&i(e=>e+1)},m=()=>{t>1&&i(e=>e-1)};return(0,a.useEffect)(()=>{o(t.toString())},[t]),(0,r.jsxs)("div",{className:n().wrapper,children:[(0,r.jsx)(l.z,{sizeMode:"sm",variant:"orange",onClick:m,children:(0,r.jsx)("i",{className:"fa fa-minus","aria-hidden":"true"})}),(0,r.jsx)(s.I,{onBlur:d,value:c,onChange:u,type:"text"}),(0,r.jsx)(l.z,{sizeMode:"sm",variant:"orange",onClick:h,children:(0,r.jsx)("i",{className:"fa fa-plus","aria-hidden":"true"})})]})}},2489:function(e,t,i){"use strict";i.d(t,{a:function(){return c}});var r=i(5893);i(7294);var a=i(9794),l=i(4898),s=i.n(l);let c=e=>{let{withoutOverlay:t}=e;return(0,r.jsx)("div",{className:(0,a.o)([s().loading,t?void 0:s().overlay]),children:(0,r.jsx)("i",{className:"fa fa-repeat","aria-hidden":"true"})})}},458:function(e,t,i){"use strict";var r=i(5838);let a="cart";t.Z=new class{add(e,t){let i=r.Y.get(a);r.Y.set(a,{...i||{},[e]:t})}remove(e){let t=r.Y.get(a);t&&(delete t[e],r.Y.set(a,t))}}},2836:function(e){e.exports={section:"CartPage_section__k1QGG",table:"CartPage_table__8qSiW"}},2452:function(e){e.exports={mobile:"MobileView_mobile__XPLwD",mobile_image:"MobileView_mobile_image__MWt9F",mobile_price:"MobileView_mobile_price__vqZ_U"}},6:function(e){e.exports={wrapper:"CountInput_wrapper__AZKJT"}},4898:function(e){e.exports={loading:"Loader_loading___H9TE",show:"Loader_show__YFqMF",rotate:"Loader_rotate__x_v_I",overlay:"Loader_overlay__lKXgr"}},8564:function(e){e.exports={title:"ProductRow_title__vgAqP",count:"ProductRow_count__WHBo8",price:"ProductRow_price__wfsEt",delete:"ProductRow_delete__T82HU"}}},function(e){e.O(0,[317,774,888,179],function(){return e(e.s=4476)}),_N_E=e.O()}]);